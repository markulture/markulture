---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import { getEntry } from 'astro:content';

const aboutPage = await getEntry('pages', 'about');
const { Content } = await aboutPage.render();
---

<Layout 
  title="About Us - Markulture" 
  description="We're an honest bunch that won't pull the wool over your eyes."
>
  <Navigation />

  <!-- Markdown Content Section -->
  {aboutPage && aboutPage.data.bodyVisual && (
    <div class="bg-white" set:html={aboutPage.data.bodyVisual} />
  )}

  

  <!-- Team Modal -->
  <div id="team-modal" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300" aria-hidden="true">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" id="modal-backdrop"></div>
    
    <!-- Modal Content -->
    <div class="relative w-full h-full flex items-center justify-center p-4 md:p-8 pointer-events-none">
      <div class="bg-black text-white w-full max-w-6xl rounded-[2.5rem] overflow-hidden relative flex flex-col lg:flex-row shadow-2xl border border-gray-800 max-h-[90vh] lg:max-h-none overflow-y-auto lg:overflow-visible pointer-events-auto">
        
        <!-- Close Button -->
        <button id="modal-close" class="absolute top-6 right-6 z-20 w-10 h-10 bg-[#5EEAD4] rounded-full flex items-center justify-center text-black hover:bg-white transition-colors">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>

        <!-- Image Side -->
        <div class="w-full lg:w-5/12 bg-[#5EEAD4] relative min-h-[300px] lg:min-h-[600px] p-8 flex items-end justify-center">
           <img id="modal-image" src="" alt="" class="w-full h-auto object-contain max-h-[500px]" />
           <div class="absolute bottom-8 left-8 text-black lg:hidden">
              <h3 id="modal-name-mobile" class="text-2xl font-bold"></h3>
              <p id="modal-role-mobile" class="text-sm font-medium"></p>
           </div>
        </div>

        <!-- Content Side -->
        <div class="w-full lg:w-7/12 p-8 md:p-16 flex flex-col justify-center">
          <div class="hidden lg:block mb-12">
            <p class="text-2xl font-medium mb-2">Meet</p>
            <h2 id="modal-name" class="text-5xl font-bold text-[#5EEAD4] mb-2"></h2>
            <p id="modal-role" class="text-xl text-gray-400"></p>
          </div>

          <div class="space-y-8">
            <div>
              <h4 class="text-xl font-bold mb-4">I'm responsible for...</h4>
              <p id="modal-responsible" class="text-gray-300 leading-relaxed"></p>
            </div>
            
            <div>
              <h4 class="text-xl font-bold mb-4">My favourite thing about my role...</h4>
              <p id="modal-favourite" class="text-gray-300 leading-relaxed whitespace-pre-line"></p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const teamData = {
      'katie': {
        name: 'Katie Chandler',
        role: 'Senior Social Media Director',
        image: 'https://placehold.co/400x500',
        responsible: 'Leading our social media strategy and ensuring our clients get the best possible engagement and reach across all platforms.',
        favourite: 'I love seeing a campaign come to life and the reaction from the community. Building genuine connections between brands and their audience is what drives me.'
      },
      'jacob': {
        name: 'Jacob Stuckes',
        role: 'New Business Director',
        image: 'https://placehold.co/400x500',
        responsible: 'Identifying new opportunities for growth and building relationships with potential partners who share our vision.',
        favourite: 'The thrill of the chase and the satisfaction of bringing on board a new client who we know we can do amazing work for.'
      },
      'jeremy': {
        name: 'Jeremy Nicoll',
        role: 'Social Media Executive',
        image: 'https://placehold.co/400x500',
        responsible: 'Creating engaging content and managing communities to keep the conversation going.',
        favourite: 'The fast-paced nature of social media means no two days are the same. I love the creativity involved in crafting the perfect post.'
      },
      'emily': {
        name: 'Emily Millar',
        role: 'Account Director',
        image: 'https://placehold.co/400x500',
        responsible: 'Ensuring our clients are happy and that their campaigns are delivered on time and on budget.',
        favourite: 'Building long-term relationships with clients and becoming a trusted extension of their team.'
      },
      'kellie': {
        name: 'Kellie Mason',
        role: 'Internal Ops & People Director',
        image: 'https://placehold.co/400x500',
        responsible: 'Making sure the agency runs smoothly and that our team has everything they need to thrive.',
        favourite: 'Seeing the team grow and develop. Creating a culture where everyone feels supported and empowered to do their best work.'
      },
      'becky': {
        name: 'Becky Robson',
        role: 'Senior Paid Social Manager',
        image: 'https://placehold.co/400x500',
        responsible: 'As a Senior Paid Social Manager, my role consists of managing the day-to-day paid media deliverables across multiple platforms for a variety of clients.',
        favourite: "I've always been passionate and interested in the world of marketing.\n\nI started my marketing career in Organic social, but soon found a new love for Paid Media. I enjoy finding and implementing new strategies and plans to help achieve and reach the clients' objectives.\n\nI absolutely love how creative TSS is and being able to share creative direction and suggestions to the client, from a paid perspective.\n\nAs for the people... I mean, who wouldn't want to be a part of such a dynamic, passionate and driven team!"
      }
    };

    function initTeamModal() {
      const modal = document.getElementById('team-modal');
      const closeBtn = document.getElementById('modal-close');
      const backdrop = document.getElementById('modal-backdrop');
      const triggers = document.querySelectorAll('.team-trigger');

      if (!modal || !closeBtn || !backdrop) return;

      const openModal = (memberId) => {
        const data = teamData[memberId];
        if (!data) return;

        // Populate data
        document.getElementById('modal-image').src = data.image;
        document.getElementById('modal-image').alt = data.name;
        
        document.getElementById('modal-name').textContent = data.name;
        document.getElementById('modal-role').textContent = data.role;
        
        document.getElementById('modal-name-mobile').textContent = data.name;
        document.getElementById('modal-role-mobile').textContent = data.role;
        
        document.getElementById('modal-responsible').textContent = data.responsible;
        document.getElementById('modal-favourite').textContent = data.favourite;

        // Show modal
        modal.classList.remove('hidden');
        // Small delay to allow display:block to apply before opacity transition
        requestAnimationFrame(() => {
          modal.classList.remove('opacity-0');
        });
        document.body.style.overflow = 'hidden';
      };

      const closeModal = () => {
        modal.classList.add('opacity-0');
        setTimeout(() => {
          modal.classList.add('hidden');
          document.body.style.overflow = '';
        }, 300);
      };

      triggers.forEach(trigger => {
        trigger.addEventListener('click', () => {
          const memberId = trigger.getAttribute('data-member-id');
          openModal(memberId);
        });
      });

      closeBtn.addEventListener('click', closeModal);
      backdrop.addEventListener('click', closeModal);
      
      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
          closeModal();
        }
      });
    }

    function initValuesSlider() {
      const track = document.getElementById('values-track');
      const dots = document.querySelectorAll('#values-dots button');
      const nextBtn = document.getElementById('values-next-btn');
      const prevBtn = document.getElementById('values-prev-btn');
      
      if (!track || !dots.length || !nextBtn || !prevBtn) return;

      let currentIndex = 0;
      const totalSlides = dots.length;

      function updateSlider() {
        const isDesktop = window.matchMedia('(min-width: 1024px)').matches;
        const isTablet = window.matchMedia('(min-width: 768px)').matches;
        
        let itemsVisible = 1;
        if (isDesktop) itemsVisible = 3;
        else if (isTablet) itemsVisible = 2;
        
        const percentage = (100 / itemsVisible) * currentIndex;
        track.style.transform = `translateX(-${percentage}%)`;
        
        dots.forEach((dot, idx) => {
          if (idx === currentIndex) {
            dot.classList.remove('bg-gray-300', 'w-2');
            dot.classList.add('bg-[#5EEAD4]', 'w-8');
          } else {
            dot.classList.add('bg-gray-300', 'w-2');
            dot.classList.remove('bg-[#5EEAD4]', 'w-8');
          }
        });
      }

      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          currentIndex = index;
          updateSlider();
        });
      });

      nextBtn.addEventListener('click', () => {
        const isDesktop = window.matchMedia('(min-width: 1024px)').matches;
        const isTablet = window.matchMedia('(min-width: 768px)').matches;
        let itemsVisible = 1;
        if (isDesktop) itemsVisible = 3;
        else if (isTablet) itemsVisible = 2;

        // Prevent scrolling past the last visible set
        if (currentIndex < totalSlides - itemsVisible + (itemsVisible === 1 ? 0 : 1)) { 
             // Actually, the HeroContent logic just does (currentIndex + 1) % totalSlides
             // But that loops. Let's see if the user wants looping.
             // The HeroContent logic: currentIndex = (currentIndex + 1) % totalSlides;
             // This implies infinite loop or wrap around.
             // Let's stick to the HeroContent logic exactly for now.
             currentIndex = (currentIndex + 1) % totalSlides;
        } else {
             // If we want to stop at the end, we'd do Math.min
             // But let's follow the requested "similar to HeroContent"
             currentIndex = (currentIndex + 1) % totalSlides;
        }
        updateSlider();
      });

      prevBtn.addEventListener('click', () => {
         currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
         updateSlider();
      });
      
      // Add touch/swipe support
      let touchStartX = 0;
      let touchEndX = 0;
      
      track.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      });
      
      track.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      });
      
      function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            // Swipe left - next slide
            currentIndex = (currentIndex + 1) % totalSlides;
          } else {
            // Swipe right - previous slide
            currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
          }
          updateSlider();
        }
      }
      
      window.addEventListener('resize', updateSlider);
      
      // Initial update
      updateSlider();
    }

    // Initialize on load
    initValuesSlider();
    initTeamModal();
    
    // Re-initialize on view transitions if using Astro View Transitions
    document.addEventListener('astro:page-load', () => {
      initValuesSlider();
      initTeamModal();
    });
  </script>
  
  <Footer />
</Layout>
